<launch>
    <arg name="use_laserscan_convert" default="true"/>

    <node_container pkg="rclcpp_components" exec="component_container" name="sensing_container" namespace="/sensing">
        <!-- LiDAR点変換 -->
        <composable_node pkg="natto_lidar_converter" plugin="laserscan_to_pointcloud2::laserscan_to_pointcloud2" name="laserscan_to_pointcloud2_front" namespace="/sensing/lidar" if="$(var use_laserscan_convert)">
            <param name="frame_id" value="lidar_front"/>
            <remap from="laserscan" to="/sensing/lidar/laser_scan/front"/>
            <remap from="pointcloud2" to="/sensing/lidar/pointcloud2/front"/>
        </composable_node>
        <composable_node pkg="natto_lidar_converter" plugin="laserscan_to_pointcloud2::laserscan_to_pointcloud2" name="laserscan_to_pointcloud2_rear" namespace="/sensing/lidar" if="$(var use_laserscan_convert)">
            <param name="frame_id" value="lidar_rear"/>
            <remap from="laserscan" to="/sensing/lidar/laser_scan/rear"/>
            <remap from="pointcloud2" to="/sensing/lidar/pointcloud2/rear"/>
        </composable_node>

        <!-- LiDAR点群合成 -->
        <composable_node pkg="natto_lidar_merger" plugin="pointcloud2_merger::pointcloud2_merger" name="pointcloud2_merger" namespace="/sensing/lidar">
            <param name="frame_id" value="base_link"/>
            <remap from="pointcloud2_first" to="/sensing/lidar/pointcloud2/front"/>
            <remap from="pointcloud2_second" to="/sensing/lidar/pointcloud2/rear"/>
            <remap from="merged_pointcloud2" to="/sensing/lidar/pointcloud2/merged"/>
            <remap from="footprint" to="/robot/footprint"/>
        </composable_node>

        <!-- 直線検出 -->
        <composable_node pkg="natto_ransac" plugin="line_detector::line_detector" name="line_detector" namespace="/sensing/lidar">
            <param name="max_iterations" value="30"/>
            <param name="distance_threshold" value="0.01"/>
            <param name="min_inliers" value="150"/>
            <param name="max_lines" value="5"/>
            <remap from="pointcloud2" to="/sensing/lidar/pointcloud2/merged"/>
        </composable_node>
    </node_container>
</launch>