<?xml version="1.0"?>
<launch>
    <node_container pkg="rclcpp_components" exec="component_container" name="common_container" namespace="/common">
        <composable_node pkg="natto_map" plugin="map_loader::map_loader" name="map_loader" namespace="/common" if="$(var publish_map)">
            <param name="line_segments_path" value="$(var line_segments_path)"/>
            <param name="circles_path" value="$(var circles_path)"/>
        </composable_node>

        <composable_node pkg="natto_map" plugin="map_converter::map_converter" name="map_converter" namespace="/common" if="$(var publish_map)">
            <param name="resolution" value="$(var occupancy_grid_resolution)"/>
        </composable_node>

        <composable_node pkg="natto_visualization_converter" plugin="footprint_publisher::footprint_publisher" name="footprint_publisher" namespace="/common">
            <param from="$(var footprint_param_path)"/>
        </composable_node>
    </node_container>

    <node_container pkg="rclcpp_components" exec="component_container" name="common_robot_container" namespace="/">
        <composable_node pkg="robot_state_publisher" plugin="robot_state_publisher::RobotStatePublisher" name="robot_state_publisher" namespace="/">
            <param name="robot_description" value="$(command 'xacro $(var urdf_path)')"/>
            <param name="frame_prefix" value=""/>
            <param name="publish_frequency" value="100.0"/>
        </composable_node>

        <composable_node pkg="robot_state_publisher" plugin="robot_state_publisher::RobotStatePublisher" name="command_robot_state_publisher" namespace="/">
            <param name="robot_description" value="$(command 'xacro $(var urdf_path)')"/>
            <remap from="/joint_states" to="/command_joint_states"/>
            <param name="frame_prefix" value="command/"/>
            <remap from="/robot_description" to="/command_robot_description"/>
            <param name="publish_frequency" value="100.0"/>
        </composable_node>

        <composable_node pkg="natto_joint_state" plugin="joint_state_merger::joint_state_merger" name="joint_state_merger" namespace="/">
            <param name="joint_state_topics" value="$(var joint_state_topics)"/>
        </composable_node>

        <composable_node pkg="natto_joint_state" plugin="joint_state_rule::joint_state_rule" name="joint_state_rule" namespace="/">
            <remap from="/command_joint_states" to="/merged_joint_states"/>
            <remap from="/fixed_command_joint_states" to="/command_joint_states"/>
            <param from="$(var joint_rule_path)"/>
        </composable_node>

        <composable_node pkg="tf2_ros" plugin="tf2_ros::StaticTransformBroadcasterNode" name="base_to_command_base" namespace="/">
            <param name="frame_id" value="base_link"/>
            <param name="child_frame_id" value="command/base_link"/>
        </composable_node>
    </node_container>
</launch>
